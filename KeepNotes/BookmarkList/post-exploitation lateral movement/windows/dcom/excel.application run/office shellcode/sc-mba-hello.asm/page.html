<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>sc-mba-hello.asm</title>
</head><body>; Shellcode to display a "Hello from injected shell code!" MessageBox<br/>
; Written for NASM assembler (http://www.nasm.us) by Didier Stevens<br/>
; https://DidierStevens.com<br/>
; Use at your own risk<br/>
;<br/>
; History:<br/>
; &nbsp; 2008/10/14: start, based on The Shellcoder's Handbook http://eu.wiley.com/WileyCDA/WileyTitle/productCd-0764544683.html<br/>
; &nbsp; 2008/10/15: LookupFunctions<br/>
; &nbsp; 2008/10/18: Cleanup for bpmtk inject-code demo<br/>
; &nbsp; 2008/11/22: Refactoring<br/>
; &nbsp; 2008/11/24: Refactored functions to include file<br/>
<br/>
BITS 32<br/>
<br/>
USER32_HASH equ 0x00038f88<br/>
USER32_NUMBER_OF_FUNCTIONS equ 1<br/>
USER32_MESSAGEBOXA_HASH equ 0x0006b81a<br/>
<br/>
segment .text<br/>
&#09;call geteip<br/>
geteip:<br/>
&#09;pop ebx<br/>
<br/>
&nbsp; ; Setup environment<br/>
&#09;lea esi, [USER32_FUNCTIONS_TABLE-geteip+ebx]<br/>
&#09;push esi<br/>
&#09;lea esi, [USER32_HASHES_TABLE-geteip+ebx]<br/>
&#09;push esi<br/>
&#09;push USER32_NUMBER_OF_FUNCTIONS<br/>
&#09;push USER32_HASH<br/>
&#09;call LookupFunctions<br/>
&#09;<br/>
&#09;; Display MessageBox<br/>
&#09;push 0x00<br/>
&#09;lea eax, [HELLO-geteip+ebx]<br/>
&#09;push eax<br/>
&#09;push eax<br/>
&#09;push 0x00<br/>
&#09;call [USER32_MESSAGEBOXA-geteip+ebx]<br/>
<br/>
&#09;ret<br/>
<br/>
%include "sc-api-functions.asm"<br/>
&#09;<br/>
USER32_HASHES_TABLE:<br/>
&#09;dd USER32_MESSAGEBOXA_HASH<br/>
<br/>
USER32_FUNCTIONS_TABLE:<br/>
USER32_MESSAGEBOXA dd 0x00000000<br/>
<br/>
HELLO:<br/>
&#09;db "Hello from injected shellcode!", 0<br/>
</body></html>