<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>General Primer</title>
</head><body>Remote Movement:<br/>
<br/>
1) psexec<br/>
<br/>
&nbsp; &nbsp;The tried and true method for lateral movement on windows. You can use<br/>
&nbsp; &nbsp;psexec [1], winexe [2], metasploit's psexec_psh [3], Powershell Empire's<br/>
&nbsp; &nbsp;invoke_psexec [4], or the builtin windows command "sc" [5]. For the<br/>
&nbsp; &nbsp;metasploit module, powershell empire, and pth-winexe [6], you just need the<br/>
&nbsp; &nbsp;hash, not the password. It's the most universal method (it works on any<br/>
&nbsp; &nbsp;windows computer with port 445 open), but it's also the least stealthy.<br/>
&nbsp; &nbsp;Event type 7045 "Service Control Manager" will appear in the event logs. In<br/>
&nbsp; &nbsp;my experience, no one has ever noticed during a hack, but it helps the<br/>
&nbsp; &nbsp;investigators piece together what the hacker did afterwards.<br/>
<br/>
2) WMI<br/>
<br/>
&nbsp; &nbsp;The most stealthy method. The WMI service is enabled on all windows<br/>
&nbsp; &nbsp;computers, but except for servers, the firewall blocks it by default. You<br/>
&nbsp; &nbsp;can use wmiexec.py [7], pth-wmis [6] (here's a demonstration of wmiexec and<br/>
&nbsp; &nbsp;pth-wmis [8]), Powershell Empire's invoke_wmi [9], or the windows builtin<br/>
&nbsp; &nbsp;wmic [5]. All except wmic just need the hash.<br/>
<br/>
3) PSRemoting [10]<br/>
<br/>
&nbsp; &nbsp;It's disabled by default, and I don't recommend enabling new protocols.<br/>
&nbsp; &nbsp;But, if the sysadmin has already enabled it, it's very convenient,<br/>
&nbsp; &nbsp;especially if you use powershell for everything (and you should use<br/>
&nbsp; &nbsp;powershell for almost everything, it will change [11] with powershell 5 and<br/>
&nbsp; &nbsp;windows 10, but for now powershell makes it easy to do everything in RAM,<br/>
&nbsp; &nbsp;avoid AV, and leave a small footprint)<br/>
<br/>
4) Scheduled Tasks<br/>
<br/>
&nbsp; &nbsp;You can execute remote programs with at and schtasks [5]. It works in the<br/>
&nbsp; &nbsp;same situations where you could use psexec, and it also leaves a well known<br/>
&nbsp; &nbsp;footprint [12].<br/>
<br/>
5) GPO<br/>
<br/>
&nbsp; &nbsp;If all those protocols are disabled or blocked by the firewall, once you're<br/>
&nbsp; &nbsp;Domain Admin, you can use GPO to give users a login script, install an msi,<br/>
&nbsp; &nbsp;execute a scheduled task [13], or, like we'll see with the computer of<br/>
&nbsp; &nbsp;Mauro Romeo (one of Hacking Team's sysadmins), use GPO to enable WMI and<br/>
&nbsp; &nbsp;open the firewall.<br/>
<br/>
<br/>
</body></html>