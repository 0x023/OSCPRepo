<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>General Primer</title>
</head><body>https://pen-testing.sans.org/blog/2013/03/18/a-penetration-testers-pledge <br/>
<br/>
Just a note here that PSExec passes credentials in the clear when using the -u and -p options. Please don't do it. <br/>
<br/>
That being said, PSExec is one of the preferred methods of pivoting through a Windows environment once SMB credentials have been obtained. <br/>
<br/>
Regardless of the variant you use, psexec leverages your credentials to make an SMB connection to the target machine, writes into its file system some code you want to execute, creates a service on the box, and uses the service to execute your code. If you use the Metasploit or NSE versions of psexec, it then cleans up after itself, by deleting the service and removing the code from the file system (both the service and code have a pseudo-random name in Metasploit and NSE).<br/>
<br/>
Important note: the Microsoft Sysinternals psexec program doesn't remove the service that it creates. Thus, as a penetration tester, you'll either leave behind an installed service on the machine, or you'll need to remove it after you are done. I like to remove it, restoring the environment to what it was like before I was there, lest I slightly increase the attack service of the target machine by leaving behind the psexec service and its related code. You can remove it using the Microsoft service control (sc) command, as follows:<br/>
<br/>
C:\&gt; sc \&lt;RemoteTarget&gt; stop psexesvc<br/>
C:\&gt; del \&lt;RemoteTarget&gt;\admin$\psexesvc.exe<br/>
C:\&gt; del \&lt;RemoteTarget&gt;\admin$\system32\psexesvc.exe<br/>
C:\&gt; sc \&lt;RemoteTarget&gt; delete psexesvc<br/>
<br/>
What is PsExec?<br/>
The PsExec utility was designed as part of the PsTools suite, originally developed by Mark Russinovich of Sysinternals, now owned by Microsoft. The tool is coined as a command line based remote administration tool and allows for the remote execution of processes on other systems. It is very flexible in that it will allow for the use of alternate authentication credentials rather than those of the user executing it, meaning you can manage devices separated by domain and site boundaries. Not only can PsExec execute programs on a remote system, but it can also redirect console input and output between systems so that you can use interactive tools remotely.<br/>
<br/>
Unlike most Microsoft associated software, the inner workings of PsExec are no secret and are fairly straightforward. PsExec allows redirects of the input and output of a remotely started executable through the use of SMB and the hidden $ADMIN share on the remote system. With this share, PsExec uses the Windows Service control Manager API to start the PsExecsvc service on the remote system which creates a named pipe that PsExec communicates with. This named pipe is what allows for input/output redirection back to the system that launched PsExec.<br/>
<br/>
When you execute PsExec it defaults to the %SYSTEM% directory on the remote system you are attempting to run the command on.</body></html>