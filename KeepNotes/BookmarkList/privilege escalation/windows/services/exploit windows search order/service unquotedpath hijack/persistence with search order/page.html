<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Persistence With Search Order</title>
</head><body>http://blakhal0.blogspot.com/2012/08/hiding-files-by-exploiting-spaces-in.html<br/>
<br/>
So say we use this batch file to create a new service:<br/>
<br/>
@echo off<br/>
sc create "Windows UDP Processor" binpath= "C:\program files\common files\run.exe" start= demand type= own<br/>
sc description "Windows UDP Processor" "Manages Windows UDP Routing Traffic"<br/>
<br/>
*note: I always try to make things look as un-suspicious as possible hence the "sc description" command to add a description to the service. It's the little things kids.<br/>
<br/>
Since we didn't use escaped quotes in the bin path we end up with a binpath of this:<br/>
C:\Program Files\Common Files\Run.exe<br/>
Instead of<br/>
"C:\Program Files\Common Files\Run.exe"<br/>
<br/>
(we SHOULD have used this "\"C:\Program files\common files\run.exe"\" as the binpath) <br/>
<br/>
I've already dumped my malicious file common.exe in C:\Program Files\.<br/>
<br/>
When this service starts it will run C:\Program Files\common.exe not C:\Program Files\Common Files\Run.exe<br/>
<br/>
IF the service ever gets examined most likely the person will check Run.exe, see that it's legit / harmless and move on missing the real file that is being executed.<br/>
<br/>
Pretty sneaky right?<br/>
<br/>
Well except for the part where you created a new service, that's still kinda sketchy.<br/>
But, if you find a legit service with spaces (more than one, usually in C:\Program Files) in the path you can modify the binpath of the service and remove the quotes (that it should have) and then place your file in the path with the proper name. Having your malicious file start the intended executable will belay suspicion. <br/>
<br/>
There you have it, a legitimate service, pointing to a legitimate executable, but we're jumping in the middle and getting our file executed.<br/>
<br/>
Then all you have to do is worry about AntiVirus programs going NOM NOM NOM on your files.<br/>
<br/>
This works for Service BinPaths and Registry Keys, with batch files you have to go about it a little different.<br/>
<br/>
With Batch files you can't have spaces in the path. End of the story.<br/>
<br/>
So if you tried to call C:\Program Files\Crappy App\Whatever.exe without quotes, unless there's a C:\Programs.exe it's going to fail with a file not found.<br/>
So you have to use the short path name for everything up to where you want it to break and execute the file.<br/>
Like this:<br/>
C:\Progra~1\Crappy App\Whatever.exe<br/>
This would execute C:\Program Files\Crappy.exe <br/>
<br/>
So there you have it, a different view. Using spaces to hide the true path of execution instead of using it to exploit a priv escalation.</body></html>