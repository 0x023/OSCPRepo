<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Identify Service Versions</title>
</head><body>Ideally, we can use -sV to probe the ports to find the version running. When performing a version scan (-sV), Nmap sends a series of probes, each of which is assigned a rarity value between one and nine. The higher the number, the more likely it is the service will be correctly identified. However, high intensity scans take longer. The intensity must be between 0 and 9. The default is 7. <br/>
<br/>
Ideally, to avoid the IDS Detection, we should avoid using -sV option. However, we can keep the noise less by using --version intensity by which we can control the number of probes sent to determine the service. Setting this option to 0 will send only the Null probe (connect and wait for banner) and any probes that have been specifically listed as pertaining to the scanned port in nmap-service-probes. The other options available are below:<br/>
--version-light (Enable light mode) : Alias for --version-intensity 2.<br/>
--version-all (Try every single probe) : An alias for --version-intensity 9<br/>
--version-trace (Trace version scan activity) : Print debugging information.<br/>
<br/>
Also, when -sV is specified apart from the probes, all the scripts in the Version category are executed. These scripts could be prevented from running by removing them from the script.db catalog or by building Nmap without NSE support (./configure --without-liblua). However, if --version-intensity option is less than 7, those scripts won't be executed ( I might be a little wrong here). <br/>
<br/>
So our scan would become approx<br/>
nmap &lt;IP_Address_Range&gt; -n --top-ports &lt;number&gt;/-p &lt;Custom Port List&gt; -sV --version-intensity 0/ (No -sV)<br/>
<br/>
Performance: So, How can we improve the performance of our nmap scan, so that result could be achieved faster. However, as always we will have Time Vs Accuracy Trade off.<br/>
-T&lt;0-5&gt;: Set timing template (higher is faster)<br/>
--min-rtt-timeout/max-rtt-timeout/initial-rtt-timeout &lt;time&gt;: Specifies probe round trip time.<br/>
--max-retries &lt;tries&gt;: Caps number of port scan probe retransmissions.<br/>
--host-timeout &lt;time&gt;: Give up on target after this long<br/>
--scan-delay/--max-scan-delay &lt;time&gt;: Adjust delay between probes<br/>
--min-rate &lt;number&gt;: Send packets no slower than &lt;number&gt; per second<br/>
--max-rate &lt;number&gt;: Send packets no faster than &lt;number&gt; per second<br/>
<br/>
T0,T1,T2 is specifically for IDS Evasion. T3 is the default.<br/>
We can set max-retries to a lower value such as 2. Currently it's 10 for T0,T1,T2,T3; 6 for T4 and 2 for T5. <br/>
<br/>
Nmap Scripts: <br/>
As bonsaiviking says <a href="https://web.archive.org/web/20170113213434/http://blog.bonsaiviking.com/2015/07/they-see-me-scannin-part-2.html">Here</a>:<br/>
If you are wild enough to try NSE scripts against an IDS-protected target, you should know how to read Lua, since the script sources are the final authority on what data is sent. But if you're just looking to get a little better at blending in, these tips should help:<ul><li>Use --script-args-file to pass script arguments to Nmap from a file. This will keep your command line clean and make it harder to accidentally miss one of the options you choose</li>
<li>Obviously avoid dos, intrusive, and exploit category scripts.</li>
<li>Use scripts by name instead of by category, so that you know exactly what will be run.</li>
<li>Thoroughly read the documentation for each script you intend to use.</li>
<li>Set http.useragent to something believable that blends in. Currently, The HTTP scripts all use a User-Agent header that identifies as "Nmap Scripting Engine."</li>
</ul>
<br/>
Output Options:<br/>
-oN/-oX/-oS/-oG &lt;file&gt;: Output scan in normal, XML, s|&lt;rIpt kIddi3, and Grepable format, respectively, to the given filename.<br/>
-oA &lt;basename&gt;: Output in the three major formats at once<br/>
--reason: Display the reason a port is in a particular state<br/>
--open: Only show open (or possibly open) ports<br/>
--packet-trace: Show all packets sent and received<br/>
--resume &lt;filename&gt;: Resume an aborted scan : Filename should be .nmap or .gnmap<br/>
<br/>
At this point, it's good to find what are the most common ports open in the scan we just performed by<br/>
grep "^[0-9]\+" &lt;nmap file .nmap extension&gt; | grep "\ open\ " | sort | uniq -c | sort -rn | awk '{print "\""$1"\",\""$2"\",\""$3"\",\""$4"\",\""$5" "$6" "$7" "$8" "$9" "$10" "$11" "$12" "$13"\""}' &gt; test.csv<br/>
</body></html>