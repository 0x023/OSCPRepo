<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Get-ADDomainAccountPolicies</title>
</head><body>Function Get-ADDomainAccountPolicies {<br/>
#https://gallery.technet.microsoft.com/scriptcenter/Get-ADDomainAccountPolicies-d3a97a4f<br/>
##########################################################################################################<br/>
&lt;#<br/>
.SYNOPSIS<br/>
&nbsp; &nbsp; Obtain a domain's Account Lockout and Password policies <br/>
<br/>
.DESCRIPTION<br/>
&nbsp; &nbsp; Reads account lockout and password attributes from the domain header for a supplied domain<br/>
<br/>
.EXAMPLE<br/>
&nbsp; &nbsp; Get-ADDomainAccountPolicies -Domain contoso.com<br/>
<br/>
&nbsp; &nbsp; Returns the Account Lockout and Password policies for the contoso.com domain, e.g...<br/>
<br/>
&nbsp; &nbsp; PolicyType : Account Lockout<br/>
&nbsp; &nbsp; DistinguishedNane : DC=contoso,DC=com<br/>
&nbsp; &nbsp; lockoutDuration : 30 minutes<br/>
&nbsp; &nbsp; lockoutObservationWindow : 30 minutes<br/>
&nbsp; &nbsp; lockoutThreshold : 50<br/>
<br/>
&nbsp; &nbsp; PolicyType : Password<br/>
&nbsp; &nbsp; DistinguishedNane : DC=contoso,DC=com<br/>
&nbsp; &nbsp; minPwdAge : 1 days<br/>
&nbsp; &nbsp; maxPwdAge : 60 days<br/>
&nbsp; &nbsp; minPwdLength : 8<br/>
&nbsp; &nbsp; pwdHistoryLength : 24<br/>
&nbsp; &nbsp; pwdProperties : Passwords must be complex and the administrator account cannot be locked out<br/>
<br/>
.NOTES<br/>
&nbsp; &nbsp; THIS CODE-SAMPLE IS PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED <br/>
&nbsp; &nbsp; OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF MERCHANTABILITY AND/OR <br/>
&nbsp; &nbsp; FITNESS FOR A PARTICULAR PURPOSE.<br/>
<br/>
&nbsp; &nbsp; This sample is not supported under any Microsoft standard support program or service. <br/>
&nbsp; &nbsp; The script is provided AS IS without warranty of any kind. Microsoft further disclaims all<br/>
&nbsp; &nbsp; implied warranties including, without limitation, any implied warranties of merchantability<br/>
&nbsp; &nbsp; or of fitness for a particular purpose. The entire risk arising out of the use or performance<br/>
&nbsp; &nbsp; of the sample and documentation remains with you. In no event shall Microsoft, its authors,<br/>
&nbsp; &nbsp; or anyone else involved in the creation, production, or delivery of the script be liable for <br/>
&nbsp; &nbsp; any damages whatsoever (including, without limitation, damages for loss of business profits, <br/>
&nbsp; &nbsp; business interruption, loss of business information, or other pecuniary loss) arising out of <br/>
&nbsp; &nbsp; the use of or inability to use the sample or documentation, even if Microsoft has been advised <br/>
&nbsp; &nbsp; of the possibility of such damages, rising out of the use of or inability to use the sample script, <br/>
&nbsp; &nbsp; even if Microsoft has been advised of the possibility of such damages. <br/>
#&gt;<br/>
##########################################################################################################<br/>
<br/>
#Requires -version 3<br/>
#Requires -modules ActiveDirectory<br/>
<br/>
&nbsp; &nbsp; #Define and validate parameters<br/>
&nbsp; &nbsp; [CmdletBinding()]<br/>
&nbsp; &nbsp; Param(<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #The target DistinguishedName<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [parameter(Mandatory=$True,Position=1)]<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ValidateScript({Get-ADDomain -Identity $_})] <br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [String]$Domain<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br/>
&nbsp; &nbsp; &nbsp; &nbsp; ##Get the RootDSE &nbsp; &nbsp;$RootDSE = Get-ADRootDSE -Server $Domain &nbsp; &nbsp;##Get the Account Lockout policy &nbsp; &nbsp;#Store specific attributes from the domain header &nbsp; &nbsp;$AccountPolicy = Get-ADObject $RootDSE.defaultNamingContext -Property lockoutDuration,lockoutObservationWindow,lockoutThreshold -Server $Domain<br/>
<br/>
&nbsp; &nbsp; #Format the Account Lockout policy<br/>
&nbsp; &nbsp; $AccountPolicy | Select @{n="PolicyType";e={"Account Lockout"}},` &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DistinguishedName,` &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;@{n="lockoutDuration";e={"$($_.lockoutDuration / -600000000) minutes"}},`<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @{n="lockoutObservationWindow";e={"$($_.lockoutObservationWindow / -600000000) minutes"}},`<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lockoutThreshold | Format-List<br/>
<br/>
<br/>
&nbsp; &nbsp; ##Get the Password policy &nbsp; &nbsp;#Store specific attributes from the domain header &nbsp; &nbsp;<br/>
&nbsp; &nbsp; $PasswordPolicy = Get-ADObject $RootDSE.defaultNamingContext -Property minPwdAge,maxPwdAge,minPwdLength,pwdHistoryLength,pwdProperties -Server $Domain<br/>
&nbsp; &nbsp; <br/>
&nbsp; &nbsp; #Format the Password policy<br/>
&nbsp; &nbsp; $PasswordPolicy | Select @{n="PolicyType";e={"Password"}},`<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DistinguishedName,` &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @{n="minPwdAge";e={"$($_.minPwdAge / -864000000000) days"}},`<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;@{n="maxPwdAge";e={"$($_.maxPwdAge / -864000000000) days"}},`<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;minPwdLength,` &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pwdHistoryLength,`<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;@{n="pwdProperties";e={Switch ($_.pwdProperties) {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 {"Passwords can be simple and the administrator account cannot be locked out"} <br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 {"Passwords must be complex and the administrator account cannot be locked out"} <br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8 {"Passwords can be simple, and the administrator account can be locked out"} <br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 9 {"Passwords must be complex, and the administrator account can be locked out"} <br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Default {$_.pwdProperties}}}}<br/>
<br/>
} &nbsp; #End of Function Get-ADDomainAccountPolicies</body></html>