<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Mitigation</title>
</head><body>Mitigation<br/>
<br/>
The simplest way to mitigate this issue is to ensure that no computer accounts are members of admin groups. Make this policy and enforce it by regularly checking admin groups for computer accounts.<br/>
Scanning for this with PowerShell is pretty simple since all that needs to be done is to search for all groups with “admin” in the name (or similar customized to the environment) and flag any member that is objecttype = ‘computer’.<br/>
<br/>
Here’s a quick PowerShell script (requires the Active Directory PowerShell module) that will look for “admin” groups and identify the groups with computer accounts as members.<br/>
<br/>
&nbsp; &nbsp; Import-Module ActiveDirectory<br/>
<br/>
&nbsp; &nbsp; $AdminGroupsWithComputersAsMembersCountHashTable &nbsp;= @{}<br/>
<br/>
&nbsp; &nbsp; [array]$DomAdminGroups = get-adgroup -filter {Name -like “*admin*”}<br/>
&nbsp; &nbsp; [int]$DomAdminGroupsCount = $DomAdminGroups.Count<br/>
&nbsp; &nbsp; Write-Output “Scanning the $DomAdminGroupsCount Admin Groups in $ForestDomainItem for computer accounts as members”<br/>
<br/>
&nbsp; &nbsp; ForEach ($DomAdminGroupsItem in $DomAdminGroups)<br/>
&nbsp; &nbsp; {<br/>
&nbsp; &nbsp; [array]$GroupContainsComputerMembers = Get-ADGroupMember $DomAdminGroupsItem.DistinguishedName -Recursive | Where {$_.objectClass -eq ‘computer’} $AdminGroupsWithComputersAsMembersCountHashTable.Set_Item($DomAdminGroupsItem.DistinguishedName,$GroupContainsComputerMembers.Count)<br/>
&nbsp; &nbsp; [int]$DomainAdminGroupsWithComputersCount = $DomainAdminGroupsWithComputersCount + $GroupContainsComputerMembersCount<br/>
&nbsp; &nbsp; }<br/>
<br/>
&nbsp; &nbsp; Write-Output “$DomainAdminGroupsWithComputersCount Forest Admin groups contain computer accounts”<br/>
&nbsp; &nbsp; $AdminGroupsWithComputersAsMembersCountHashTable<br/>
<br/>
As always, this script is provided “as is.”<br/>
<br/>
PowerView, now integrated into PowerSploit, includes capability to help identify computers in admin groups:<br/>
<br/>
&nbsp; &nbsp; Get-NetGroup -AdminCount | Get-NetGroupMember -Recurse | ?{$_.MemberName -like ‘*$’}</body></html>