<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Identifying Logs With Wevtutil</title>
</head><body>If you need a more fine grained approach you can trigger tasks on highly specific Windows events. Doing so is a bit more labour intensive but it gives you unparalleled control over you task execution. The only caveat is that the target needs to have event logging enable for the event you want to target. You can piggyback the existing event loggers, but there does not seem to be a straight forward way to add custom events from the command line (it may be possible to import a custom event manifest but I have not tested this). If you have GUI access, custom events can be configured using gpedit.msc. A more detailed explanation can be found <a href="http://superuser.com/questions/538146/run-a-batch-cmd-upon-screensaver/538849">here</a>.<br/>
<br/>
<br/>
We can check the last recorded "User initiated Logoff" event by referencing the event channel (Security) and the event ID (4647).<br/>
C:\Windows\system32&gt; wevtutil qe Security /f:text /c:1 /q:"Event[System[(EventID=4647)]]<br/>
<br/>
Event[0]:<br/>
&nbsp; Log Name: Security<br/>
&nbsp; Source: Microsoft-Windows-Security-Auditing<br/>
&nbsp; Date: 2014-09-13T21:05:54.339<br/>
&nbsp; Event ID: 4647<br/>
&nbsp; Task: Logoff<br/>
&nbsp; Level: Information<br/>
&nbsp; Opcode: Info<br/>
&nbsp; Keyword: Audit Success<br/>
&nbsp; User: N/A<br/>
&nbsp; User Name: N/A<br/>
&nbsp; Computer: Win7-Testbed<br/>
&nbsp; Description:<br/>
User initiated logoff:<br/>
<br/>
Subject:<br/>
&nbsp; &nbsp; &nbsp; &nbsp; Security ID: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;S-1-5-21-2436999474-2994553960-2820488997-1001<br/>
&nbsp; &nbsp; &nbsp; &nbsp; Account Name: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Fubar<br/>
&nbsp; &nbsp; &nbsp; &nbsp; Account Domain: &nbsp; &nbsp; &nbsp; &nbsp; Win7-Testbed<br/>
&nbsp; &nbsp; &nbsp; &nbsp; Logon ID: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x14afc<br/>
<br/>
<br/>
<br/>
With this information in hand we can create a scheduled task. We will need to provide schtasks with the appropriate event channel and the XPath query string for the target event</body></html>