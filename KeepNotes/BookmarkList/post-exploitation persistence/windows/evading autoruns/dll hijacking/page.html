<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>DLL Hijacking</title>
</head><body>Technique that can be abused to cause Windows to load a malicious DLL rather than the intended one<br/>
Publicly known since Windows XP<br/>
AutoRuns will display the exec that is persisted, but not any of the DLLs<br/>
<br/>
Applications use the Windows LoadLibrary() to request that Windows find and load a DLL into memory<br/>
Windows follows a defined lookup process to find the requested DLL<br/>
&nbsp;&#09;Dir from which the application was loaded<br/>
&nbsp;&#09;System dir (system32)<br/>
&nbsp;&#09;16-bit system directory<br/>
&nbsp;&#09;Windows dir (C:\Windows)<br/>
&nbsp;&#09;Current dir<br/>
&nbsp;&#09;Dir listed in the PATH env<br/>
First DLL found with a matching name will be loaded<br/>
Malware gets exec by placing malicious DLL in dir searched prior to dir containing real DLL<br/>
&nbsp;&#09;Can exec abritrary code at this point<br/>
<br/>
Dridex<br/>
One variant uses DLL Hijacking and a technique called AtomBombing<br/>
AutoRuns only sees the signed exec<br/>
Used DLL hijacking to evade detection by hiding behind a legitimate signed exec (like sysinternals signed execs)<br/>
&nbsp;&#09;Hashes execs until it finds a match<br/>
&nbsp;&#09;Copies the matching exec to the users profile (AppData\Roaming)<br/>
&nbsp; &#09;Random DLL chosen from imports list and copied into users profile with legit exec<br/>
&nbsp;&#09;Malicious shellcode injected into the DLL that will be run when DLL is loaded<br/>
&nbsp;&#09;Creates a reg key and shortcut pointing to legit exec<br/>
&nbsp;&#09;Runs legit exec when user logs on<br/>
&nbsp;&#09;&#09;Loads malicious DLL<br/>
&nbsp;&#09;&#09;Exec malicious injected code<br/>
</body></html>