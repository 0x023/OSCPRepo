<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>File Association Hijack</title>
</head><body>Choose the user's favourite file type, replace the program which handles the opening with a similar one described in the previous section, and voila!<br/>
<br/>
<br/>
What happens when you click on a .TXT file? &nbsp; The operating system checks the HKEY_CLASSES_ROOT hive for the associated extension to see what program it should launch. &nbsp; Here we see the associate for .TXT files mapped to “txtfile”. &nbsp;<br/>
<img src="image.png" /><br/>
<br/>
Further down in the HKEY_CLASSES_ROOT hive we find the entry for “txtfile” where the applications that are used to “open” and “print” are defined. &nbsp; Here you can see that NOTEPAD.EXE is the application that will launch when the OS tries to OPEN a txt file. &nbsp;<br/>
<img src="image 2.png" /><br/>
<br/>
<br/>
What if the attacker or his malware changes this association? &nbsp; Instead of launching notepad it tells the OS to launch NOTPAD.EXE. &nbsp; &nbsp; NOTPAD.EXE is wrapper around the real NOTEPAD.EXE but it also contains a malicious payload. &nbsp; During the initial infection the attacker makes this change and leaves his NOTPAD.EXE behind. &nbsp; &nbsp;You remove the initial attack vector and do memory forensics to find nothing running on the host. &nbsp; Sometime later, after memory of the incident fades the administrator checks his logs by clicking on a .TXT file. &nbsp; It launches NOTPAD.EXE which in turn launches NOTEPAD.EXE and reinfects the machine. &nbsp;<br/>
In an alternate version of this attack a new file extension is created such as .WTD. &nbsp; When the attacker is ready to reinfect you they send in email with a .WTD extension. &nbsp; When it is opened on the victim’s machine they are reinfected. &nbsp; <br/>
I am sure some of you will say, “but NOTPAD.EXE will be detected by AV”. &nbsp; &nbsp; Perhaps, but remember the point of these is to evade memory forensics. &nbsp; For the most part, evading antivirus software is trivial.'<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<b>Detection</b>:<br/>
How do you detect this? &nbsp;Well, baseline the contents of your HKEY_CLASSES_ROOT registry key and then periodically check its current state against that baseline. &nbsp; Investigate any changes to see what executes when you click on the file extensions that have changed. &nbsp;We all know it is dangerous to click links on the internet. &nbsp; Unfortunately links on your computer aren’t any safer once an attacker has had a chance to change where they go. &nbsp; </body></html>